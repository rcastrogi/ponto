{% extends "base.html" %}
{% block title %}Justificativas{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="bi bi-file-earmark-medical me-2"></i>Justificativas</h3>
        <a href="{{ url_for('nova_justificativa') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Nova Justificativa
        </a>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Colaborador</th>
                            <th>Tipo</th>
                            <th>Período</th>
                            <th class="text-center">Dias</th>
                            <th>Descrição</th>
                            <th class="text-center">Anexo</th>
                            <th class="text-center">Status</th>
                            {% if session.get('is_gestor') %}
                            <th class="text-center">Ações</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for j in justificativas %}
                        <tr>
                            <td class="fw-bold">{{ j.colaborador_nome }}</td>
                            <td>
                                {% if j.tipo == 'atestado' %}
                                <span class="badge bg-info"><i class="bi bi-hospital me-1"></i>Atestado</span>
                                {% elif j.tipo == 'falta_justificada' %}
                                <span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle me-1"></i>Falta Justificada</span>
                                {% elif j.tipo == 'ferias' %}
                                <span class="badge bg-success"><i class="bi bi-sun me-1"></i>Férias</span>
                                {% elif j.tipo == 'licenca' %}
                                <span class="badge bg-secondary"><i class="bi bi-file-text me-1"></i>Licença</span>
                                {% else %}
                                <span class="badge bg-dark">{{ j.tipo }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {{ j.data_inicio[8:10] }}/{{ j.data_inicio[5:7] }}/{{ j.data_inicio[0:4] }}
                                a
                                {{ j.data_fim[8:10] }}/{{ j.data_fim[5:7] }}/{{ j.data_fim[0:4] }}
                            </td>
                            <td class="text-center">
                                <span class="badge bg-primary">{{ j.dias }} dia{{ 's' if j.dias > 1 else '' }}</span>
                            </td>
                            <td>{{ j.descricao or '-' }}</td>
                            <td class="text-center">
                                {% if j.arquivo_atestado %}
                                <a href="{{ url_for('download_atestado', filename=j.arquivo_atestado) }}"
                                   target="_blank" class="btn btn-sm btn-outline-info" title="Ver atestado">
                                    <i class="bi bi-file-earmark-arrow-down"></i>
                                </a>
                                {% else %}
                                <small class="text-muted">-</small>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if j.status == 'aprovado' %}
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Aprovado</span>
                                {% elif j.status == 'rejeitado' %}
                                <span class="badge bg-danger"><i class="bi bi-x-circle me-1"></i>Rejeitado</span>
                                {% else %}
                                <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>Pendente</span>
                                {% endif %}
                            </td>
                            {% if session.get('is_gestor') %}
                            <td class="text-center">
                                {% if j.status == 'pendente' %}
                                <form method="POST" action="{{ url_for('aprovar_justificativa', just_id=j.id) }}"
                                      class="d-inline">
                                    <input type="hidden" name="acao" value="aprovar">
                                    <button class="btn btn-sm btn-success me-1" title="Aprovar">
                                        <i class="bi bi-check"></i>
                                    </button>
                                </form>
                                <form method="POST" action="{{ url_for('aprovar_justificativa', just_id=j.id) }}"
                                      class="d-inline">
                                    <input type="hidden" name="acao" value="rejeitar">
                                    <button class="btn btn-sm btn-danger" title="Rejeitar">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </form>
                                {% else %}
                                <small class="text-muted">-</small>
                                {% endif %}
                            </td>
                            {% endif %}
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-center text-muted py-4">
                                Nenhuma justificativa registrada.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
